<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs–– -->
  <meta charset="utf-8">
  <title>Making a Stacked Area Graph</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.min.css">

  <!-- CSS -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/customize.css">
  <script src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet' />
  <style>
  #map_1,#map_2,#map_3 {
    height: 500px;
  }
  </style>

  <!-- D3 v4 -->
  <script src="https://d3js.org/d3.v4.js"></script>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>
<body>

  <div class="container one-bottom" style="margin-top: 50px">
    <div class="ten columns">
      <h2>Mobility on Demand Systems: Data-Driven Analysis, Simulation, Visualization</h2>
      <p>
        ARCH 6306/6050, DSBA 6010, ITIS 8010/6010: Wednesdays 6pm-8:30pm, Taught Online
        <br>
        Dr. Dimitris Papanikolaou | dpapanik@uncc.edu | Urban Synergetics Lab | https://urbansynergeticslab.net
      </p>
    </div>
    <div class="two columns">
      <a href="https://urbansynergeticslab.net/"><img class="scale-with-grid" src="img/LabLogo_dark_cropped.png"></a>
    </div>
  </div>

  <div class="container one-bottom" style="margin-top: 50px">
    <div class="twelve columns">
      <h3>Arc Graph</h3>
      <p></p>
      <div id="my_dataviz"></div>
    </div>
  </div>



    <div class="container one-bottom" style="margin-top: 50px">
      <div class="four columns offset-by-four">
        <a href="https://urbansynergeticslab.net/"><img class="scale-with-grid" src="img/LabLogo_dark_cropped.png"></a>
      </div>
    </div>


    <script>

    // set the dimensions and margins of the graph
    var margin = {top: 20, right: 30, bottom: 20, left: 30},
      width = 600 - margin.left - margin.right,
      height = 300 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

    // Read dummy data
    d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/data_network.json", function( data) {

      // List of node names
      var allNodes = data.nodes.map(function(d){return d.name})

      // A linear scale to position the nodes on the X axis
      var x = d3.scalePoint()
        .range([0, width])
        .domain(allNodes)



      // Add links between nodes. Here is the tricky part.
      // In my input data, links are provided between nodes -id-, NOT between node names.
      // So I have to do a link between this id and the name
      var idToNode = {};
      data.nodes.forEach(function (n) {
        idToNode[n.id] = n;
      });
      // Cool, now if I do idToNode["2"].name I've got the name of the node with id 2

      // Add the links
      svg
        .selectAll('mylinks')
        .data(data.links)
        .enter()
        .append('path')
        .attr('d', function (d) {
          start = x(idToNode[d.source].name)    // X position of start node on the X axis
          end = x(idToNode[d.target].name)      // X position of end node
          return ['M', start, height-30,    // the arc starts at the coordinate x=start, y=height-30 (where the starting node is)
            'A',                            // This means we're gonna build an elliptical arc
            (start - end)/2, ',',    // Next 2 lines are the coordinates of the inflexion point. Height of this point is proportional with start - end distance
            (start - end)/2, 0, 0, ',',
            start < end ? 1 : 0, end, ',', height-30] // We always want the arc on top. So if end is before start, putting 0 here turn the arc upside down.
            .join(' ');
        })
        .style("fill", "none")
        .attr("stroke", "black")


        // Add the circle for the nodes
        svg
          .selectAll("mynodes")
          .data(data.nodes)
          .enter()
          .append("circle")
            .attr("cx", function(d){ return(x(d.name))})
            .attr("cy", height-30)
            .attr("r", 6)
            .style("fill", "red")

        // And give them a label
        svg
          .selectAll("mylabels")
          .data(data.nodes)
          .enter()
          .append("text")
            .attr("x", function(d){ return(x(d.name))})
            .attr("y", height-10)
            .text(function(d){ return(d.name)})
            .style("text-anchor", "middle")
      

    })

    </script>


  </body>
  </html>
